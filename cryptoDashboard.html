<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto Dashboard</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/2.3.2/css/dataTables.dataTables.css" />
    <link rel="stylesheet" href="https://unpkg.com/boxicons@latest/css/boxicons.min.css">    
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <style>
        body {
            font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
        }
        
    </style>
    <div class="d-flex justify-content-between p-3">
        <div>
            <h2>Crypto Dashboard</h2>
        </div>
        <div>
            <button class="btn btn-primary" onclick="refresh()">Refresh</button>
        </div>
    </div>
    <div class="container">
        <div>
            <ul class="nav nav-tabs" id="myTab" role="tablist">
  <li class="nav-item" role="presentation">
    <button class="nav-link active" id="home-tab" data-bs-toggle="tab" data-bs-target="#home-tab-pane" type="button" role="tab" aria-controls="home-tab-pane" aria-selected="true">Coin</button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link" id="profile-tab" data-bs-toggle="tab" data-bs-target="#profile-tab-pane" type="button" role="tab" aria-controls="profile-tab-pane" aria-selected="false">Custom Coin</button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link" id="contact-tab" data-bs-toggle="tab" data-bs-target="#contact-tab-pane" type="button" role="tab" aria-controls="contact-tab-pane" aria-selected="false">Favorite</button>
  </li>
</ul>
<div class="tab-content" id="myTabContent">
  <div class="tab-pane fade show active" id="home-tab-pane" role="tabpanel" aria-labelledby="home-tab" tabindex="0">
      <table id="table1" class="display" style="width: 100%;">
        <thead>
            <tr>
                <th>Coin</th>
                <th>Price</th>
                <th>24hr Change</th>
                <th>Market Cap</th>
            </tr>
        </thead>
        <tbody id="tbody1"></tbody>
      </table>
      <div class="row g-3 mb-4">
      <div class="col-md-6">
         <div class="p-3 border rounded shadow-sm">
            <h3>Price Chart (Top5)</h3>
            <canvas id="chart1"></canvas>
         </div>
      </div>
       <div class="col-md-6">
         <div class="p-3 border rounded shadow-sm">
            <h3>Market Cap Chart (Top5)</h3>
            <canvas id="chart2"></canvas>
         </div>
      </div>
    </div>
    <div class="row g-3 mb-5">
        <div class="col-md-4">
         <div class="p-3 border rounded shadow-sm">
            <h3>24hr Change Price (Top5)</h3>
            <canvas id="chart3"></canvas>
         </div>
      </div>
      <div class="col-md-4">
         <div class="p-3 border rounded shadow-sm">
            <h3>24hr Change Market Cap</h3>
            <canvas id="chart4"></canvas>
         </div>
      </div>
       <div class="col-md-4">
         <div class="p-3 border rounded shadow-sm">
             <h3>Total Supply (Top5)</h3>
            <canvas id="chart5"></canvas>
         </div>
      </div>
    </div>
    </div>
    
  <div class="tab-pane fade" id="profile-tab-pane" role="tabpanel" aria-labelledby="profile-tab" tabindex="0">
    <div class="border rounded shadow-sm mt-3 p-3">
        <div>
            <h2>ADD COIN</h2>
        </div>
        <div class="d-flex align-items-end gap-3 mt-3">
        <div class="col">
            <label for="name" >Name</label>
            <input type="text" class="form-control" id="name">
        </div>
        <div class="col">
            <label for="price" >Price</label>
            <input type="number" class="form-control" id="price">
        </div>
        <div class="col">
            <label for="change" >24hr Change</label>
            <input type="number" class="form-control" id="change">
        </div>
        <div class="col">
            <label for="mcap" >Market Cap</label>
            <input type="number" class="form-control" id="mcap">
        </div>
        <div class="col">
            <label for="image-link" >Image Link</label>
            <input type="text" class="form-control" id="image-link">
        </div>
        <div class="col">
            <button class="btn btn-success" onclick="addCoin()">ADD</button>
        </div>
    </div>
    </div>
    
    <div class="modal" tabindex="-1" id="modal">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Update Coin</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="">
            <input type="hidden" id="id">
        <div class="">
            <label for="update-name" >Name</label>
            <input type="text" class="form-control" id="update-name">
        </div>
        <div class="">
            <label for="update-price" >Price</label>
            <input type="number" class="form-control" id="update-price">
        </div>
        <div class="">
            <label for="update-change" >24hr Change</label>
            <input type="number" class="form-control" id="update-change">
        </div>
        <div class="">
            <label for="update-mcap" >Market Cap</label>
            <input type="number" class="form-control" id="update-mcap">
        </div>
        <div class="">
            <label for="update-image-link" >Image Link</label>
            <input type="text" class="form-control" id="update-image-link">
        </div>
    </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" onclick="saveChanges()">Save changes</button>
      </div>
    </div>
  </div>
</div>
    <table id="table2" class="display mt-3" style="width: 100%;">
        <thead>
            <tr>
                <th>Coin</th>
                <th>Price</th>
                <th>24hr Change</th>
                <th>Market Cap</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody id="tbody2"></tbody>
      </table>
  </div>
  <div class="tab-pane fade" id="contact-tab-pane" role="tabpanel" aria-labelledby="contact-tab" tabindex="0">
    <table id="table3" class="display" style="width: 100%;">
        <thead>
            <tr>
                <th>Coin</th>
                <th>Price</th>
                <th>24hr Change</th>
                <th>Market Cap</th>
            </tr>
        </thead>
        <tbody id="tbody3"></tbody>
      </table>
  </div>
</div>
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>   
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.datatables.net/2.3.2/js/dataTables.js"></script>
    <script>
        let chart1;
        let chart2;
        let chart3;
        let chart4;
        let chart5;
        let coins = JSON.parse(localStorage.getItem('saved')) || [];
        let customCoins = JSON.parse(localStorage.getItem('custom')) || [];
        let favoriteCoins = JSON.parse(localStorage.getItem('favorite')) || [];
       async function loadCoins() {
            if(coins.length === 0) {
                const res = await fetch('https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&per_page=50');
                coins = await res.json();
                localStorage.setItem('saved',JSON.stringify(coins));
            }
            renderCoins()
            renderCustom()
            renderFavorites()
            renderChart1(coins)
            renderChart2(coins)
            renderChart3(coins)
            renderChart4(coins)
            renderChart5(coins)
        }
        function renderCoins() {
            const tbody1 = document.getElementById('tbody1');
             if($.fn.DataTable.isDataTable('#table1')){
                $('#table1').DataTable().destroy()
            }
            tbody1.innerHTML = '';
            coins.forEach(coin => {
                const tr = document.createElement('tr');
                const tdcoin = document.createElement('td');
                const i = document.createElement('i');
                i.className = favoriteCoins.includes(coin.id) ? 'bx bxs-star' : 'bx bx-star';
                i.style.marginRight = '6px';
                i.style.cursor = 'pointer';
                i.addEventListener('click', () => {
                 const isFavorite = favoriteCoins.includes(coin.id);
                 if(isFavorite) {
                    favoriteCoins = favoriteCoins.filter(c => c !== coin.id);
                    i.classList.remove('bxs-star');
                    i.classList.add('bx-star');
                 }
                 else {
                    favoriteCoins.push(coin.id) 
                    i.classList.remove('bx-star');
                    i.classList.add('bxs-star');
                    localStorage.setItem('favorite',JSON.stringify(favoriteCoins));
                 }
                  loadCoins()
                })
                const image = document.createElement('img');
                image.src = coin.image;
                image.style.marginRight = '6px';
                image.width = 20;
                const name = document.createElement('span');
                name.textContent = coin.name;

                tdcoin.append(i,image,name);

                const tdprice = document.createElement('td');
                tdprice.textContent = `$${coin.current_price}`;

                const tdchange = document.createElement('td');
                const change = coin.price_change_percentage_24h;
                tdchange.textContent = `${change}%`;
                tdchange.style.color = change > 0 ? 'green' : 'red';

                const tdmcap = document.createElement('td');
                tdmcap.textContent = `$${coin.market_cap}`

                tr.append(tdcoin,tdprice,tdchange,tdmcap);
                tbody1.appendChild(tr);
            });
            $('#table1').DataTable({
                order : [[3,'desc']]
            })
        }

        function addCoin() {
            const name = document.getElementById('name').value;
            const price = document.getElementById('price').value;
            const change = document.getElementById('change').value;
            const mcap = document.getElementById('mcap').value;
            const image = document.getElementById('image-link').value;
            const id = document.getElementById('name').value.toLowerCase();

            const upcoin = {
                name : name,
                current_price : price,
                price_change_percentage_24h : change,
                market_cap : mcap,
                image : image,
                id : id
            }
            if(!name || !price || !change || !mcap || !image) {
                alert('please fill out all fields before adding');
                return;
            }
            const exist = customCoins.some(c => c.id === id);
            if(exist) {
                alert('coin already exist');
                return;
            }
            else {
                customCoins.push(upcoin);
                localStorage.setItem('custom',JSON.stringify(customCoins));
                renderCustom()
            }

            document.getElementById('name').value = '';
            document.getElementById('price').value = '';
            document.getElementById('change').value = '';
            document.getElementById('mcap').value = '';
            document.getElementById('image-link').value = '';

        }
        
        function renderCustom() {
            const tbody2 = document.getElementById('tbody2');
            if($.fn.DataTable.isDataTable('#table2')){
                $('#table2').DataTable().destroy()
            }
            tbody2.innerHTML = '';
            customCoins.forEach(coin => {
                const tr = document.createElement('tr');
                const tdcoin = document.createElement('td');
                const i = document.createElement('i');
                i.className = favoriteCoins.includes(coin.id) ? 'bx bxs-star' : 'bx bx-star';
                i.style.marginRight = '6px';
                i.style.cursor = 'pointer';
                 i.addEventListener('click', () => {
                 const isFavorite = favoriteCoins.includes(coin.id);
                 if(isFavorite) {
                    favoriteCoins = favoriteCoins.filter(c => c !== coin.id);
                    i.classList.remove('bxs-star');
                    i.classList.add('bx-star');
                 }
                 else {
                    favoriteCoins.push(coin.id) 
                    i.classList.remove('bx-star');
                    i.classList.add('bxs-star');
                    localStorage.setItem('favorite',JSON.stringify(favoriteCoins));
                 }
                 loadCoins()
                })
                const image = document.createElement('img');
                image.src = coin.image;
                image.style.marginRight = '6px';
                image.style.borderRadius = '50%';
                image.height = 20;
                image.width = 20;
                const name = document.createElement('span');
                name.textContent = coin.name;

                tdcoin.append(i,image,name);

                const tdprice = document.createElement('td');
                tdprice.textContent = `$${coin.current_price}`;

                const tdchange = document.createElement('td');
                const change = coin.price_change_percentage_24h;
                tdchange.textContent = `${change}%`;
                tdchange.style.color = change > 0 ? 'green' : 'red';

                const tdmcap = document.createElement('td');
                tdmcap.textContent = `$${coin.market_cap}`;

                const tdbtn = document.createElement('td');
                const updbtn = document.createElement('button');
                updbtn.className = 'btn btn-success';
                updbtn.textContent = 'Update';
                updbtn.style.marginRight = '4px';
                updbtn.onclick = () => {
                    document.getElementById('id').value = coin.name.toLowerCase();
                    document.getElementById('update-name').value = coin.name;
                    document.getElementById('update-price').value = coin.current_price;
                    document.getElementById('update-change').value = change;
                    document.getElementById('update-image-link').value = coin.image;
                    document.getElementById('update-mcap').value = coin.market_cap;
                    const modal = new bootstrap.Modal(document.getElementById('modal'));
                    modal.show()
                }
                const delbtn = document.createElement('button');
                delbtn.textContent = 'Delete';
                delbtn.className = 'btn btn-danger';
                delbtn.onclick = () => {
                    customCoins = customCoins.filter(c => c.id !== coin.id);
                    localStorage.setItem('custom',JSON.stringify(customCoins));
                    renderCustom()
                }

                tdbtn.append(updbtn,delbtn);

                tr.append(tdcoin,tdprice,tdchange,tdmcap,tdbtn);
                tbody2.appendChild(tr);
            });
           if(customCoins.length > 0) {
             $('#table2').DataTable({
                order : [[3,'desc']]
            })
           }
        }
        function saveChanges() {
            const name = document.getElementById('update-name').value;
            const current_price = document.getElementById('update-price').value;
            const price_change_percentage_24h = document.getElementById('update-change').value;
            const market_cap = document.getElementById('update-mcap').value;
            const image = document.getElementById('update-image-link').value;
            const newid = document.getElementById('update-name').value.toLowerCase();
            const oldid = document.getElementById('id').value.toLowerCase();

            const duplicate = customCoins.some(c =>
              c.id !== oldid && (c.name.toLowerCase() === name.toLowerCase() || c.id === newid)
            );

            if(duplicate) {
                alert('coin already exist')
                return;
            }
            customCoins = customCoins.map(c => {
                if(c.id === oldid) {
                    return {
                        ...c,
                        name : name,
                        current_price : current_price,
                        price_change_percentage_24h : price_change_percentage_24h,
                        market_cap : market_cap,
                        image : image,
                        id : newid
                    }
                }
                return c;
            })
            favoriteCoins = favoriteCoins.map(c=> c === oldid ? newid : c);
            localStorage.setItem('custom',JSON.stringify(customCoins));
            localStorage.setItem('favorite',JSON.stringify(favoriteCoins));
            renderCustom()
            renderFavorites()
            const modal = bootstrap.Modal.getInstance(document.getElementById('modal'));
            modal.hide()
        }
        function renderFavorites() {
            const allCoins = [...coins,...customCoins];
            const filtered = allCoins.filter(c => favoriteCoins.includes(c.id));
            const tbody3 = document.getElementById('tbody3');
            if($.fn.DataTable.isDataTable('#table3')){
                $('#table3').DataTable().destroy()
            }
            tbody3.innerHTML = '';
            filtered.forEach(coin => {
                const tr = document.createElement('tr');
                const tdcoin = document.createElement('td');
                const i = document.createElement('i');
                i.className = favoriteCoins.includes(coin.id) ? 'bx bxs-star' : 'bx bx-star';
                i.style.marginRight = '6px';
                i.style.cursor = 'pointer';
                 i.addEventListener('click', () => {
                 const isFavorite = favoriteCoins.includes(coin.id);
                 if(isFavorite) {
                    favoriteCoins = favoriteCoins.filter(c => c !== coin.id);
                    i.classList.remove('bxs-star');
                    i.classList.add('bx-star');
                 }
                 else {
                    favoriteCoins.push(coin.id) 
                    i.classList.remove('bx-star');
                    i.classList.add('bxs-star');
                    localStorage.setItem('favorite',JSON.stringify(favoriteCoins));
                 }
                 loadCoins()
                })
                const image = document.createElement('img');
                image.src = coin.image;
                image.style.marginRight = '6px';
                image.width = 20;
                image.style.borderRadius = '50%';
                image.height = 20;
                const name = document.createElement('span');
                name.textContent = coin.name;

                tdcoin.append(i,image,name);

                const tdprice = document.createElement('td');
                tdprice.textContent = `$${coin.current_price}`;

                const tdchange = document.createElement('td');
                const change = coin.price_change_percentage_24h;
                tdchange.textContent = `${change}%`;
                tdchange.style.color = change > 0 ? 'green' : 'red';

                const tdmcap = document.createElement('td');
                tdmcap.textContent = `$${coin.market_cap}`;

                tr.append(tdcoin,tdprice,tdchange,tdmcap);
                tbody3.appendChild(tr);
            });
           if(filtered.length > 0) {
             $('#table3').DataTable({
                order : [[3,'desc']]
            })
           }
        }
        function renderChart1(coins) {
            if(chart1) {
                chart1.destroy()
            }
            const sorted = coins.sort((a,b) => b.current_price - a.current_price);
            const top5 = sorted.slice(0,5);

            const labels = top5.map(coin => coin.name);
            const data1 = top5.map(coin => coin.current_price);
            const data = {
            labels: labels,
            datasets: [{
            label: 'Price(USD)',
            data:data1,
            backgroundColor: [
            'rgba(255, 99, 132, 0.2)',
            'rgba(255, 159, 64, 0.2)',
            'rgba(255, 205, 86, 0.2)',
            'rgba(75, 192, 192, 0.2)',
            'rgba(54, 162, 235, 0.2)',
            'rgba(153, 102, 255, 0.2)',
            'rgba(201, 203, 207, 0.2)'
            ],
            borderColor: [
            'rgb(255, 99, 132)',
            'rgb(255, 159, 64)',
            'rgb(255, 205, 86)',
            'rgb(75, 192, 192)',
            'rgb(54, 162, 235)',
            'rgb(153, 102, 255)',
            'rgb(201, 203, 207)'
            ],
            borderWidth: 1
        }]
        };
        const config = {
        type: 'bar',
        data: data,
        options: {
        scales: {
        y: {
        beginAtZero: true
        }
        }
      },
      };
      chart1 = new Chart(document.getElementById('chart1'),config)
        }
        function renderChart2() {
            if(chart2) {
                chart2.destroy()
            }
            const sorted = coins.sort((a,b) => b.market_cap - a.market_cap);
            const top5 = sorted.slice(0,5);

            const labels = top5.map(coin => coin.name);
            const data1 = top5.map(coin => coin.market_cap);
            const data = { 
            labels: labels,
            datasets: [{
            label: 'Market Cap',
            data: data1,
            fill: false,
            borderColor: 'rgb(75, 192, 192)',
            tension: 0.1
        }]
       };
            const config = {
            type: 'line',
            data: data,
         };
         chart2 = new Chart(document.getElementById('chart2'),config)
        }
        function renderChart3(coins) {
            if(chart3){
                chart3.destroy()
            }
            const sorted = coins.sort((a,b) => b.price_change_percentage_24h - a.price_change_percentage_24h);
            const top5 = sorted.slice(0,5);
            const label = top5.map(coin => coin.name);
            const data1 = top5.map(coin => coin.price_change_percentage_24h);
            const data = {
            labels: label,
            datasets: [{
            label: '(USD)',
            data: data1,
            backgroundColor: [
            'rgb(255, 99, 132)',
            'rgb(54, 162, 235)',
            'rgb(255, 205, 86)'
            ],
            hoverOffset: 4
            }]
          };
          const config = {
          type: 'doughnut',
          data: data,
          };
          chart3 = new Chart(document.getElementById('chart3'),config);
        }
        function renderChart4(coins) {
            if(chart4) {
                chart4.destroy()
            }
            const sorted = coins.sort((a,b) => b.market_cap_change_24h - a.market_cap_change_24h);
            const top5 = sorted.slice(0,5);
            const label = top5.map(coin => coin.name);
            const data1 = top5.map(coin => coin.market_cap_change_24h);
            const data = {
            labels: label,
            datasets: [{
            label: '(USD)',
            data: data1,
            backgroundColor: [
            'rgb(255, 99, 132)',
            'rgb(54, 162, 235)',
            'rgb(255, 205, 86)'
            ],
            hoverOffset: 4
            }]
          };
          const config = {
          type: 'pie',
          data: data,
         };
         chart4 = new Chart(document.getElementById('chart4'),config);
        }
        function renderChart5(coins) {
            if(chart5) {
                chart5.destroy()
            }
            const sorted = coins.sort((a,b) => b.current_price - a.current_price);
            const top5 = sorted.slice(0,5);
            const label = top5.map(coin => coin.name);
            const data1 = top5.map(coin => coin.total_supply);
            const data = {
            labels: label,
            datasets: [{
            label: 'Total Supply',
            data: data1,
            backgroundColor: [
           'rgb(144, 238, 144)',
           'rgb(54, 162, 235)',
           'rgb(255, 205, 86)'
           ],
           hoverOffset: 4
           }]
         };
         const config = {
         type: 'doughnut',
         data: data,
         };
       chart5 = new Chart(document.getElementById('chart5'),config);
        }
        function refresh() {
             localStorage.removeItem('saved');
             location.reload()
             loadcoins()
        }
         loadCoins()
    </script>
</body>
</html>
